name: Urgent PR Slack Notification

on:
  workflow_run:
    workflows: ["Sync urgent label for issue to PR"]
    types:
      - completed
  pull_request:
    types: [labeled, opened]

jobs:
  notify_urgent:
    if: contains(github.event.pull_request.labels.*.name, 'urgent')
    runs-on: ubuntu-latest
    steps:
      - name: Check PR label still present
        uses: actions/github-script@v7
        id: label_check
        with:
          script: |
            const pr = await github.rest.pulls.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.payload.pull_request.number
            });
            const hasUrgent = pr.data.labels.some(label => label.name === 'urgent');
            return hasUrgent;
      - name: Send Slack notification if urgent
        if: steps.label_check.outputs.result == 'true'
        uses: slackapi/slack-github-action@v1.25.0
        with:
          payload: |
            {
              "text": "ðŸš¨ Urgent PR: <${{ github.event.pull_request.html_url }}|${{ github.event.pull_request.title }}> needs review within 30 minutes!"
            }
